<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- åŸºæœ¬ç¶²é è¨­å®š -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šè¼¸å‡ºå¸ƒæ—å‡½æ•¸æœ€å°åŒ–å·¥å…·</title>
    
    <!-- PWA æ”¯æ´è¨­å®š -->
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å¤šè¼¸å‡ºæœ€å°åŒ–å·¥å…·">
    
    <!-- SEO å’Œç¶²é è³‡è¨Šè¨­å®š -->
    <meta name="description" content="å°ˆæ¥­çš„å¤šè¼¸å‡ºå¸ƒæ—å‡½æ•¸æœ€å°åŒ–å·¥å…·ï¼Œæ”¯æ´ Patrick Method æ¼”ç®—æ³•">
    <meta name="keywords" content="Patrick Method, é‚è¼¯æœ€å°åŒ–, å¸ƒçˆ¾ä»£æ•¸, SOP, Prime Implicants, å¤šè¼¸å‡º">
    <meta name="author" content="Logic Circuit Final Project">
    
    <!-- PWA æ‡‰ç”¨ç¨‹å¼è¨­å®š -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Boolean Minimizer">
    <meta name="apple-mobile-web-app-title" content="Boolean Minimizer">
    <meta name="msapplication-starturl" content="./index.html">
    <link rel="icon" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    
    <style>
        /* å…¨åŸŸæ¨£å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* ä¸»é«”æ¨£å¼è¨­å®š */
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }
        
        .input-section {
            padding: 30px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
        }
        
        .output-section {
            padding: 30px;
            background: white;
        }
        
        .section-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #74b9ff;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .input-mode-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .radio-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .radio-group:hover {
            border-color: #74b9ff;
            background: #f1f8ff;
        }
        
        .radio-group input[type="radio"]:checked {
            accent-color: #74b9ff;
        }
        
        .radio-group input[type="radio"]:checked + .radio-label {
            color: #74b9ff;
            font-weight: bold;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #74b9ff;
            box-shadow: 0 0 0 3px rgba(116, 185, 255, 0.1);
        }
        
        .variable-input {
            display: grid;
            grid-template-columns: 1fr 100px;
            gap: 10px;
            align-items: end;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            width: 100%;
            margin: 20px 0;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0984e3, #0770d1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-right: 10px;
            font-size: 0.9em;
            padding: 10px 20px;
            text-transform: none;
            letter-spacing: normal;
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }
        
        .button-group {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .button-group .btn {
            flex: 1;
            min-width: 140px;
        }
        
        .button-group .btn-primary {
            margin: 0;
            width: auto;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
            margin-right: 10px;
            font-size: 0.9em;
            padding: 10px 20px;
            text-transform: none;
            letter-spacing: normal;
        }
        
        .btn-info:hover {
            background: #138496;
            transform: translateY(-1px);
        }
        
        .btn-add {
            background: #28a745;
            color: white;
            font-size: 0.9em;
            padding: 10px 20px;
            text-transform: none;
            letter-spacing: normal;
        }
        
        .btn-add:hover {
            background: #218838;
        }
        
        .btn-remove {
            background: #dc3545;
            color: white;
            font-size: 0.8em;
            padding: 6px 12px;
            text-transform: none;
            letter-spacing: normal;
        }
        
        .btn-remove:hover {
            background: #c82333;
        }
        
        /* å‡½æ•¸å‹•æ…‹è¼¸å…¥æ¡†æ¨£å¼ */
        .function-input-row {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .function-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .function-label {
            font-weight: bold;
            color: #495057;
            font-size: 16px;
        }
        
        .function-inputs {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .function-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .function-input {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: border-color 0.3s ease;
            min-width: 120px;
        }
        
                    .function-input:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            }
            
            textarea:focus {
                outline: none;
                border-color: #007bff !important;
                box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            }
        
        .function-input-label {
            font-size: 14px;
            color: #495057;
            white-space: nowrap;
            font-weight: 500;
        }
        
        /* PI å‹•æ…‹è¼¸å…¥æ¡†æ¨£å¼ */
        .function-pi-group {
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .function-pi-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }
        
        .function-pi-title {
            margin: 0;
            font-size: 16px;
            color: #495057;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .function-pi-title:hover {
            color: #007bff;
        }
        
        .function-pi-indicator {
            color: #6c757d;
            font-size: 12px;
            transition: color 0.3s ease;
        }
        
        .function-pi-indicator.active {
            color: #28a745;
        }
        
        .function-pi-inputs {
            padding: 15px;
        }
        
        .pi-input-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .pi-label {
            font-weight: bold;
            color: #495057;
            min-width: 50px;
            font-size: 14px;
        }
        
        .pi-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .pi-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        .result-area {
            min-height: 300px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .result-area.has-content {
            background: white;
            border: 2px solid #28a745;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #74b9ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .example-section {
            background: #e8f4f8;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .example-title {
            font-weight: bold;
            color: #0c5460;
            margin-bottom: 10px;
        }
        
        .example-content {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #0c5460;
            line-height: 1.4;
        }
        
        /* æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
            }
            
            .header p {
                font-size: 0.95em;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                min-height: auto;
            }
            
            .input-section, .output-section {
                padding: 20px 15px;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
            
            .section-title {
                font-size: 1.3em;
                margin-bottom: 15px;
            }
            
            .form-group {
                margin-bottom: 20px;
            }
            
            .input-mode-selector {
                flex-direction: column;
                gap: 10px;
            }
            
            .radio-group {
                padding: 10px 15px;
                font-size: 0.9em;
            }
            
            .variable-input {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.95em;
                letter-spacing: 0.5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .button-group {
                flex-direction: column;
                gap: 8px;
                margin: 15px 0;
            }
            
            .button-group .btn {
                flex: none;
                min-width: auto;
                width: 100%;
                margin: 0;
            }
            
            .btn-secondary {
                font-size: 0.85em;
                padding: 10px 15px;
                margin-right: 0;
            }
            
            .function-pi-header {
                padding: 10px 12px;
                flex-direction: column !important;
                gap: 8px;
                align-items: stretch !important;
                justify-content: flex-start !important;
            }
            
            .function-pi-title {
                font-size: 0.9em;
                flex: none !important;
                min-width: auto !important;
                width: 100% !important;
                text-align: left;
                margin-bottom: 8px;
            }
            
            .function-pi-header .btn-remove {
                width: 100% !important;
                margin: 0 !important;
                font-size: 0.8em;
                padding: 8px 12px;
                flex: none !important;
            }
            
            .function-pi-inputs {
                padding: 12px;
            }
            
            .pi-input-row {
                flex-direction: column !important;
                gap: 8px;
                margin-bottom: 12px;
                align-items: stretch !important;
            }
            
            .pi-label {
                min-width: auto !important;
                font-size: 0.85em;
                width: 100%;
                margin-bottom: 5px;
            }
            
            .pi-input-row .pi-input {
                width: 100% !important;
                margin: 0 !important;
                box-sizing: border-box;
                flex: none !important;
            }
            
            .pi-input-row .btn {
                width: 100% !important;
                margin: 5px 0 0 0 !important;
                font-size: 0.8em;
                padding: 8px 12px;
                flex: none !important;
            }
            
            .function-input-row {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .function-inputs {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .function-input-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .function-input {
                min-width: auto !important;
                width: 100% !important;
                font-size: 0.9em;
                margin: 0 !important;
                box-sizing: border-box;
            }
            
            .function-input-label {
                font-size: 0.85em;
            }
            
            .example-section {
                margin-top: 15px;
            }
            
            .example-title {
                font-size: 1em;
                padding: 8px 12px;
            }
            
            .example-content {
                padding: 12px;
                font-size: 0.8em;
                line-height: 1.4;
            }
            
            .loading {
                padding: 20px 15px;
            }
            
            .result-area {
                padding: 15px;
            }
            
            .progress-details {
                margin-top: 15px;
            }
            
            .progress-box {
                padding: 12px;
            }
            
            .progress-box h4 {
                font-size: 1em;
                margin-bottom: 8px;
            }
            
            /* PI è¼¸å…¥å€åŸŸçš„æŒ‰éˆ•çµ„ */
            #piInputContainer div[style*="display: flex"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 8px !important;
                margin-top: 15px;
            }
            
            #piInputContainer div[style*="display: flex"] .btn {
                flex: none !important;
                width: 100% !important;
                min-width: auto !important;
                font-size: 0.8em;
                padding: 10px 15px;
                margin: 0 !important;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                box-sizing: border-box;
            }
            
            /* ç‰¹åˆ¥é‡å°ä¸‰å€‹æŒ‰éˆ• */
            .btn-add, .btn-secondary, .btn-info {
                width: 100% !important;
                margin: 0 !important;
                margin-bottom: 8px !important;
            }
        }
        
        /* å¼·åˆ¶ä¿®å¾© PI æ¨¡å¼æ‰‹æ©Ÿç‰ˆå•é¡Œ */
        @media (max-width: 768px) {
            /* å¼·åˆ¶ä¿®å¾© PI æ¨¡å¼åº•éƒ¨æŒ‰éˆ•çµ„ */
            #piInputContainer > div[style*="display: flex"] {
                display: flex !important;
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 8px !important;
                margin-top: 15px !important;
            }
            
            #piInputContainer > div[style*="display: flex"] .btn {
                width: 100% !important;
                margin: 0 !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                box-sizing: border-box !important;
            }
            
            /* å¼·åˆ¶ä¿®å¾©å‡½æ•¸æ¨™é¡Œå€åŸŸ */
            .function-pi-group .function-pi-header {
                display: flex !important;
                flex-direction: column !important;
                align-items: stretch !important;
                padding: 10px !important;
            }
            
            .function-pi-group .function-pi-header .function-pi-title {
                width: 100% !important;
                margin-bottom: 8px !important;
            }
            
            .function-pi-group .function-pi-header .btn-remove {
                width: 100% !important;
                margin: 0 !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            /* å¼·åˆ¶ä¿®å¾© PI è¼¸å…¥è¡Œ */
            .function-pi-inputs .pi-input-row {
                display: flex !important;
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 5px !important;
            }
            
            .function-pi-inputs .pi-input-row .pi-label {
                display: block !important;
                margin-bottom: 4px !important;
                font-weight: bold !important;
            }
            
            .function-pi-inputs .pi-input-row .pi-input {
                width: 100% !important;
                margin: 0 !important;
                box-sizing: border-box !important;
            }
            
            .function-pi-inputs .pi-input-row .btn {
                width: 100% !important;
                margin: 0 !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
        }
        
        /* è¶…å¼·åˆ¶ä¿®å¾© PI æ¨¡å¼å•é¡Œ - ä½¿ç”¨æ›´é«˜å„ªå…ˆç´š */
        @media (max-width: 768px) {
            /* é‡å° PI æ¨¡å¼åº•éƒ¨æŒ‰éˆ•çš„è¶…å¼·åˆ¶ä¿®å¾© */
            div[style*="display: flex"][style*="gap: 10px"] {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 8px !important;
            }
            
            div[style*="display: flex"][style*="gap: 10px"] button {
                width: 100% !important;
                margin: 0 !important;
                flex: none !important;
            }
            
            /* é‡å°æ‰€æœ‰ PI ç›¸é—œæŒ‰éˆ•çš„è¶…å¼·åˆ¶ä¿®å¾© */
            .btn[onclick*="addFunctionPIGroup"],
            .btn[onclick*="addPIToCurrentFunction"],
            .btn[onclick*="generateFunctionDefinitions"],
            .btn[onclick*="removeFunctionPIGroup"],
            .btn[onclick*="removePIFromFunction"] {
                width: 100% !important;
                margin: 0 !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                box-sizing: border-box !important;
            }
        }
        
        /* æ›´å°è¢å¹•çš„é¡å¤–å„ªåŒ– */
        @media (max-width: 480px) {
            .container {
                margin: 5px;
                border-radius: 8px;
            }
            
            .header {
                padding: 15px 10px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .header p {
                font-size: 0.9em;
            }
            
            .input-section, .output-section {
                padding: 15px 10px;
            }
            
            .section-title {
                font-size: 1.2em;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 0.9em;
            }
            
            .function-pi-title {
                font-size: 0.85em;
                min-width: 150px;
            }
            
            .example-content {
                font-size: 0.75em;
            }
            
            #multiplePIInputs + div .btn {
                min-width: auto;
                font-size: 0.75em;
                padding: 8px 12px;
                width: 100%;
            }
            
            .function-pi-header {
                flex-direction: column;
                gap: 6px;
            }
            
            .btn-remove {
                font-size: 0.7em;
                padding: 6px 10px;
            }
            
            .pi-input-row .btn {
                font-size: 0.7em;
                padding: 6px 10px;
            }
            
            .radio-group {
                padding: 8px 12px;
                font-size: 0.85em;
            }
            
            /* 480px ä»¥ä¸‹çš„ PI æ¨¡å¼è¶…å¼·åˆ¶ä¿®å¾© */
            div[style*="display: flex"] {
                flex-direction: column !important;
                align-items: stretch !important;
            }
            
            div[style*="display: flex"] .btn {
                width: 100% !important;
                margin: 2px 0 !important;
                flex: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œå€åŸŸ -->
        <div class="header">
            <h1>ğŸ§® å¤šè¼¸å‡ºå¸ƒæ—å‡½æ•¸æœ€å°åŒ–å·¥å…·</h1>
            <p>åŸºæ–¼ Patrick Method æ¼”ç®—æ³•çš„å¤šè¼¸å‡ºæœ€ä½³åŒ–ç³»çµ±</p>
        </div>
        
        <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
        <div class="main-content">
            <!-- è¼¸å…¥å€åŸŸ -->
            <div class="input-section">
                <h2 class="section-title">ğŸ“ è¼¸å…¥è¨­å®š</h2>
                
                <!-- è®Šæ•¸è¨­å®š -->
                <div class="form-group">
                    <label class="form-label">è®Šæ•¸è¨­å®š</label>
                    <div class="variable-input">
                        <input type="text" class="input-field" id="variables" 
                               placeholder="è¼¸å…¥è®Šæ•¸ (ä¾‹å¦‚: A,B,C,D æˆ– W,X,Y,Z)" value="A,B,C,D">
                        <button class="btn btn-secondary" onclick="clearInputs()">æ¸…é™¤</button>
                    </div>
                </div>
                
                <!-- è¼¸å…¥æ¨¡å¼é¸æ“‡ -->
                <div class="form-group">
                    <label class="form-label">è¼¸å…¥æ¨¡å¼</label>
                    <div class="input-mode-selector">
                        <label class="radio-group">
                            <input type="radio" name="inputMode" value="pi" id="modePI" checked>
                            <span class="radio-label">Prime Implicants (PI)</span>
                        </label>
                        <label class="radio-group">
                            <input type="radio" name="inputMode" value="minterm" id="modeMinterm">
                            <span class="radio-label">Minterms</span>
                        </label>
                    </div>
                </div>
                
                <!-- è¼¸å…¥å€åŸŸ -->
                <div class="form-group">
                    <label class="form-label" id="inputLabel">å¤šå‡½æ•¸ Prime Implicants</label>
                    
                    <!-- PI æ¨¡å¼ï¼šå‹•æ…‹è¼¸å…¥æ¡† -->
                    <div id="piInputContainer">
                        <div id="multiplePIInputs">
                            <!-- å‹•æ…‹ç”Ÿæˆçš„å‡½æ•¸PIå€åŸŸå°‡åœ¨é€™è£¡ -->
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button type="button" class="btn btn-add" onclick="addFunctionPIGroup()">
                                â• æ–°å¢å‡½æ•¸
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="addPIToCurrentFunction()">
                                â• æ–°å¢ PI
                            </button>
                            <button type="button" class="btn btn-info" onclick="generateFunctionDefinitions()">
                                ğŸ”„ è‡ªå‹•ç”Ÿæˆå‡½æ•¸å®šç¾©
                            </button>
                        </div>
                        
                        <!-- è¼¸å‡ºå‡½æ•¸å®šç¾©è¼¸å…¥å€åŸŸ -->
                        <div style="margin-top: 25px;">
                            <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 8px; font-size: 1.1em;">
                                è¼¸å‡ºå‡½æ•¸å®šç¾© (å„è‡ªå‡½æ•¸çš„mintermï¼Œä¸å«don't care)
                            </label>
                            <textarea id="outputFunctions" 
                                      placeholder="å®šç¾©å„è¼¸å‡ºå‡½æ•¸:&#10;F1: 0,2,4&#10;F2: 1,3,5&#10;F3: 2,6,7&#10;&#10;æˆ–ä½¿ç”¨å‚³çµ±æ ¼å¼:&#10;F1: m0,m2,m4&#10;F2: m1,m3,m5&#10;F3: m2,m6,m7"
                                      style="width: 100%; min-height: 120px; resize: vertical; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; transition: border-color 0.3s ease;"></textarea>
                            <div style="margin-top: 8px; padding: 10px; background: #e8f4f8; border-radius: 6px; font-size: 13px; color: #0c5460;">
                                ğŸ’¡ <strong>è¼¸å…¥æ ¼å¼:</strong> æ”¯æ´ç´”æ•¸å­—æ ¼å¼ (F1: 0,2,4) æˆ–å‚³çµ±æ ¼å¼ (F1: m0,m2,m4)<br>
                                ğŸ§  <strong>è‡ªå‹•å…±äº«é …æª¢æ¸¬:</strong> ç³»çµ±æœƒè‡ªå‹•åˆ†æPIæ•¸æ“šï¼Œæ‰¾å‡ºå‡½æ•¸é–“çš„å…±äº«é …
                            </div>
                        </div>
                    </div>
                    
                    <!-- Minterm æ¨¡å¼ï¼šå‡½æ•¸è¼¸å…¥ -->
                    <div id="mintermInputContainer" style="display: none;">
                        <div id="functionInputs">
                            <!-- å‹•æ…‹ç”Ÿæˆçš„å‡½æ•¸è¼¸å…¥æ¡†å°‡åœ¨é€™è£¡ -->
                        </div>
                        <button type="button" class="btn btn-add" id="addFunctionButton" onclick="addFunctionInput()">
                            â• æ–°å¢å‡½æ•¸
                        </button>
                    </div>
                </div>
                
                <!-- åŸ·è¡ŒæŒ‰éˆ• -->
                <div class="button-group" style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn btn-primary" onclick="runMultiOutputOptimization()">
                        ğŸš€ åŸ·è¡Œå¤šè¼¸å‡ºæœ€ä½³åŒ–
                    </button>
                    <button class="btn btn-secondary" onclick="shareResults()" title="åˆ†äº«çµæœ">
                        ğŸ“¤ åˆ†äº«çµæœ
                    </button>
                    <button class="btn btn-secondary" onclick="copyResultsToClipboard()" title="è¤‡è£½çµæœ">
                        ğŸ“‹ è¤‡è£½çµæœ
                    </button>
                </div>
                
                <!-- ç¯„ä¾‹å€åŸŸ -->
                <div class="example-section">
                    <div class="example-title">ğŸ’¡ è¼¸å…¥æ ¼å¼èªªæ˜</div>
                    <div class="example-content">
<strong>Prime Implicants æ¨¡å¼:</strong>
è®Šæ•¸: W,X,Y,Z
å‡½æ•¸ F1:
  PI1: 00-1  (è¦†è“‹ m1,m9)
  PI2: -110  (è¦†è“‹ m6,m14)
å‡½æ•¸ F2:
  PI1: 000-  (è¦†è“‹ m0,m1)
  PI2: 01--  (è¦†è“‹ m4,m5,m6,m7)

<strong>Minterms æ¨¡å¼:</strong>
è®Šæ•¸: W,X,Y,Z
F1 = Î£m(1,5,7,8,10,11,12,14,15) + Î£d(3,13)
F2 = Î£m(0,1,4,6,7,8,12) + Î£d(2,9)

<strong>ç‰¹è‰²åŠŸèƒ½:</strong>
â€¢ ğŸ¯ è‡ªå‹•æª¢æ¸¬å‡½æ•¸é–“çš„å…±äº« Prime Implicants
â€¢ âš¡ æ™ºèƒ½æœ€ä½³åŒ–ï¼Œæ¸›å°‘ç¸½é«”é›»è·¯æˆæœ¬
â€¢ ğŸ”§ æ”¯æ´ Don't Care é …å„ªåŒ–
â€¢ ğŸ“Š è©³ç´°é¡¯ç¤ºæœ€ä½³åŒ–æ­¥é©Ÿå’Œçµæœæ¯”è¼ƒ
                    </div>
                </div>
            </div>
            
            <!-- è¼¸å‡ºå€åŸŸ -->
            <div class="output-section">
                <h2 class="section-title">ğŸ“Š æœ€ä½³åŒ–çµæœ</h2>
                
                <!-- è¼‰å…¥å‹•ç•« -->
                <div class="loading" id="loadingArea">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åŸ·è¡Œå¤šè¼¸å‡ºæœ€ä½³åŒ–æ¼”ç®—æ³•...</p>
                    
                    <!-- é€²åº¦è©³æƒ…æ¡† -->
                    <div class="progress-details" id="progressDetails" style="display: none;">
                        <div class="progress-box">
                            <h4>ğŸ” é‹ç®—é€²åº¦è©³æƒ…</h4>
                            <div class="progress-content" id="progressContent">
                                <!-- é€²åº¦ä¿¡æ¯å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
                <div class="result-area" id="resultArea">
                    <div style="text-align: center; color: #6c757d; margin-top: 100px;">
                        <h3>ç­‰å¾…è¼¸å…¥...</h3>
                        <p>è«‹åœ¨å·¦å´è¼¸å…¥å¤šè¼¸å‡ºå‡½æ•¸è³‡æ–™ä¸¦é»æ“ŠåŸ·è¡ŒæŒ‰éˆ•</p>
                        <p style="margin-top: 20px;">ğŸ”¹ æ”¯æ´ Prime Implicants å’Œ Minterms å…©ç¨®è¼¸å…¥æ¨¡å¼</p>
                        <p>ğŸ”¹ è‡ªå‹•æœ€ä½³åŒ–å¤šå‡½æ•¸å…±äº«é …</p>
                        <p>ğŸ”¹ é¡¯ç¤ºè©³ç´°æœ€ä½³åŒ–éç¨‹</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- è¼‰å…¥æ ¸å¿ƒç®—æ³• -->
    <script src="patrick-method-core.js"></script>
    
    <!-- è¨»å†Š Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
    
    <script>
        // ==================== å…¨åŸŸè®Šæ•¸å®šç¾© ====================
        let functionPICounter = 1;           // PI æ¨¡å¼ä¸‹çš„å‡½æ•¸è¨ˆæ•¸å™¨
        let piCounterByFunction = {};        // æ¯å€‹å‡½æ•¸çš„ PI è¨ˆæ•¸å™¨å°æ‡‰è¡¨
        let currentSelectedFunction = 1;     // ç•¶å‰é¸ä¸­çš„å‡½æ•¸ ID
        let functionCounter = 1;             // Minterm æ¨¡å¼ä¸‹çš„å‡½æ•¸è¨ˆæ•¸å™¨
        
        // ==================== è¼¸å…¥æ¨¡å¼åˆ‡æ›è™•ç† ====================
        // ç›£è½è¼¸å…¥æ¨¡å¼é¸é …çš„è®ŠåŒ–
        document.querySelectorAll('input[name="inputMode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                updateInputMode(this.value);
            });
        });
        
        /**
         * æ›´æ–°è¼¸å…¥æ¨¡å¼é¡¯ç¤º
         * æ ¹æ“šé¸æ“‡çš„æ¨¡å¼ï¼ˆPI æˆ– Mintermï¼‰åˆ‡æ›å°æ‡‰çš„è¼¸å…¥ç•Œé¢
         * @param {string} mode - è¼¸å…¥æ¨¡å¼ ('pi' æˆ– 'minterm')
         */
        function updateInputMode(mode) {
            const inputLabel = document.getElementById('inputLabel');
            const piContainer = document.getElementById('piInputContainer');
            const mintermContainer = document.getElementById('mintermInputContainer');
            
            if (mode === 'pi') {
                // åˆ‡æ›åˆ° PI æ¨¡å¼
                inputLabel.textContent = 'å¤šå‡½æ•¸ Prime Implicants';
                piContainer.style.display = 'block';
                mintermContainer.style.display = 'none';
                
                // å¦‚æœå°šæœªåˆå§‹åŒ–ï¼Œå‰‡åˆå§‹åŒ– PI è¼¸å…¥æ¡†
                if (document.getElementById('multiplePIInputs').children.length === 0) {
                    initializeMultiplePIInputs();
                }
            } else {
                // åˆ‡æ›åˆ° Minterm æ¨¡å¼
                inputLabel.textContent = 'å¤šå‡½æ•¸ Minterms';
                piContainer.style.display = 'none';
                mintermContainer.style.display = 'block';
                
                // å¦‚æœå°šæœªåˆå§‹åŒ–ï¼Œå‰‡åˆå§‹åŒ– Minterm è¼¸å…¥æ¡†
                if (document.getElementById('functionInputs').children.length === 0) {
                    initializeFunctionInputs();
                }
            }
        }
        
        /**
         * åˆå§‹åŒ–å¤šè¼¸å‡º PI è¼¸å…¥æ¡†
         * æ¸…ç©ºç¾æœ‰å…§å®¹ä¸¦é‡ç½®æ‰€æœ‰è¨ˆæ•¸å™¨ï¼Œç„¶å¾Œæ·»åŠ ç¬¬ä¸€å€‹å‡½æ•¸çµ„
         */
        function initializeMultiplePIInputs() {
            const multiplePIInputs = document.getElementById('multiplePIInputs');
            multiplePIInputs.innerHTML = '';
            functionPICounter = 1;
            piCounterByFunction = {};
            currentSelectedFunction = 1;
            addFunctionPIGroup(); // æ·»åŠ ç¬¬ä¸€å€‹å‡½æ•¸çµ„
        }
        
        /**
         * æ–°å¢å‡½æ•¸ PI çµ„
         * å‰µå»ºä¸€å€‹æ–°çš„å‡½æ•¸çµ„ï¼ŒåŒ…å«æ¨™é¡Œã€PI è¼¸å…¥å€åŸŸå’Œæ§åˆ¶æŒ‰éˆ•
         */
        function addFunctionPIGroup() {
            const multiplePIInputs = document.getElementById('multiplePIInputs');
            
            // è¨ˆç®—ç•¶å‰æ‡‰è©²çš„å‡½æ•¸ç·¨è™Ÿï¼ˆå¾ 1 é–‹å§‹ï¼Œé€£çºŒç·¨è™Ÿï¼‰
            const currentFunctionCount = multiplePIInputs.children.length;
            const functionDisplayId = currentFunctionCount + 1;
            const functionId = functionPICounter++;
            piCounterByFunction[functionId] = 1;
            
            const functionDiv = document.createElement('div');
            functionDiv.className = 'function-pi-group';
            functionDiv.id = `functionPIGroup${functionId}`;
            functionDiv.setAttribute('data-display-id', functionDisplayId);
            
            functionDiv.innerHTML = `
                <div class="function-pi-header">
                    <h4 class="function-pi-title" onclick="selectFunction(${functionId})">
                        ğŸ“ å‡½æ•¸ F${functionDisplayId}
                        <span class="function-pi-indicator" id="indicator${functionId}">â— PI æ•¸é‡: 0</span>
                    </h4>
                    <button class="btn btn-remove" onclick="removeFunctionPIGroup(${functionId})">
                        âœ• ç§»é™¤å‡½æ•¸
                    </button>
                </div>
                <div class="function-pi-inputs" id="functionPIInputs${functionId}">
                    <!-- PI è¼¸å…¥æ¡†å°‡åœ¨é€™è£¡ -->
                </div>
            `;
            
            multiplePIInputs.appendChild(functionDiv);
            
            // é¸ä¸­æ–°å‰µå»ºçš„å‡½æ•¸
            selectFunction(functionId);
            
            // ç‚ºæ–°å‡½æ•¸æ·»åŠ ç¬¬ä¸€å€‹PI
            addPIToFunction(functionId);
        }
        
        // ç§»é™¤å‡½æ•¸ PI çµ„
        function removeFunctionPIGroup(functionId) {
            if (Object.keys(piCounterByFunction).length <= 1) {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹å‡½æ•¸ï¼');
                return;
            }
            
            const functionDiv = document.getElementById(`functionPIGroup${functionId}`);
            functionDiv.remove();
            delete piCounterByFunction[functionId];
            
            // é‡æ–°æ•´ç†æ‰€æœ‰å‡½æ•¸çš„ç·¨è™Ÿ
            updatePIFunctionNumbers();
            
            // å¦‚æœç§»é™¤çš„æ˜¯ç•¶å‰é¸ä¸­çš„å‡½æ•¸ï¼Œé¸ä¸­ç¬¬ä¸€å€‹å¯ç”¨çš„å‡½æ•¸
            if (currentSelectedFunction === functionId) {
                const remainingFunctions = Object.keys(piCounterByFunction);
                if (remainingFunctions.length > 0) {
                    selectFunction(parseInt(remainingFunctions[0]));
                }
            }
        }
        
        // é‡æ–°æ•´ç† PI æ¨¡å¼ä¸‹æ‰€æœ‰å‡½æ•¸çš„ç·¨è™Ÿ
        function updatePIFunctionNumbers() {
            const multiplePIInputs = document.getElementById('multiplePIInputs');
            const functionGroups = multiplePIInputs.querySelectorAll('.function-pi-group');
            
            functionGroups.forEach((group, index) => {
                const displayId = index + 1;
                group.setAttribute('data-display-id', displayId);
                
                // æ›´æ–°å‡½æ•¸æ¨™é¡Œ
                const functionTitle = group.querySelector('.function-pi-title');
                if (functionTitle) {
                    const titleText = functionTitle.childNodes[0];
                    if (titleText) {
                        titleText.textContent = `ğŸ“ å‡½æ•¸ F${displayId}`;
                    }
                }
            });
        }
        
        // é¸ä¸­å‡½æ•¸
        function selectFunction(functionId) {
            // ç§»é™¤ä¹‹å‰çš„é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.function-pi-group').forEach(group => {
                group.style.borderLeftColor = '#28a745';
            });
            
            // è¨­ç½®æ–°çš„é¸ä¸­ç‹€æ…‹
            const selectedGroup = document.getElementById(`functionPIGroup${functionId}`);
            if (selectedGroup) {
                selectedGroup.style.borderLeftColor = '#007bff';
                currentSelectedFunction = functionId;
            }
        }
        
        // ç‚ºç•¶å‰é¸ä¸­çš„å‡½æ•¸æ–°å¢ PI
        function addPIToCurrentFunction() {
            if (currentSelectedFunction && piCounterByFunction[currentSelectedFunction] !== undefined) {
                addPIToFunction(currentSelectedFunction);
            } else {
                alert('è«‹å…ˆé¸æ“‡ä¸€å€‹å‡½æ•¸ï¼');
            }
        }
        
        // ç‚ºæŒ‡å®šå‡½æ•¸æ–°å¢ PI
        function addPIToFunction(functionId) {
            const functionPIInputs = document.getElementById(`functionPIInputs${functionId}`);
            
            // è¨ˆç®—ç•¶å‰æ‡‰è©²çš„ PI ç·¨è™Ÿï¼ˆå¾1é–‹å§‹ï¼Œé€£çºŒç·¨è™Ÿï¼‰
            const currentPICount = functionPIInputs.children.length;
            const piDisplayId = currentPICount + 1;
            const piId = piCounterByFunction[functionId]++;
            
            const piRow = document.createElement('div');
            piRow.className = 'pi-input-row';
            piRow.id = `piRow${functionId}_${piId}`;
            piRow.setAttribute('data-display-id', piDisplayId);
            
            piRow.innerHTML = `
                <span class="pi-label">PI${piDisplayId}:</span>
                <input type="text" class="pi-input" 
                       placeholder="ä¾‹å¦‚: 00-1, -110, 1-01" 
                       oninput="updatePICount(${functionId})">
                <button class="btn btn-remove" onclick="removePIFromFunction(${functionId}, ${piId})">âœ•</button>
            `;
            
            functionPIInputs.appendChild(piRow);
            updatePICount(functionId);
        }
        
        // å¾å‡½æ•¸ä¸­ç§»é™¤ PI
        function removePIFromFunction(functionId, piId) {
            const piRow = document.getElementById(`piRow${functionId}_${piId}`);
            if (piRow) {
                piRow.remove();
                // é‡æ–°æ•´ç†è©²å‡½æ•¸çš„ PI ç·¨è™Ÿ
                updatePINumbers(functionId);
                updatePICount(functionId);
            }
        }
        
        // é‡æ–°æ•´ç†æŒ‡å®šå‡½æ•¸çš„ PI ç·¨è™Ÿ
        function updatePINumbers(functionId) {
            const functionPIInputs = document.getElementById(`functionPIInputs${functionId}`);
            const piRows = functionPIInputs.querySelectorAll('.pi-input-row');
            
            piRows.forEach((row, index) => {
                const displayId = index + 1;
                row.setAttribute('data-display-id', displayId);
                
                // æ›´æ–° PI æ¨™ç±¤
                const piLabel = row.querySelector('.pi-label');
                if (piLabel) {
                    piLabel.textContent = `PI${displayId}:`;
                }
            });
        }
        
        // æ›´æ–° PI æ•¸é‡é¡¯ç¤º
        function updatePICount(functionId) {
            const functionPIInputs = document.getElementById(`functionPIInputs${functionId}`);
            const piInputs = functionPIInputs.querySelectorAll('.pi-input');
            const filledPIs = Array.from(piInputs).filter(input => input.value.trim() !== '').length;
            const totalPIs = piInputs.length;
            
            const indicator = document.getElementById(`indicator${functionId}`);
            if (indicator) {
                indicator.textContent = `â— PI æ•¸é‡: ${filledPIs}/${totalPIs}`;
                indicator.className = filledPIs > 0 ? 'function-pi-indicator active' : 'function-pi-indicator';
            }
        }
        
        // åˆå§‹åŒ–å‡½æ•¸è¼¸å…¥æ¡† (Mintermæ¨¡å¼)
        function initializeFunctionInputs() {
            const functionInputs = document.getElementById('functionInputs');
            functionInputs.innerHTML = '';
            functionCounter = 1;
            addFunctionInput(); // æ·»åŠ ç¬¬ä¸€å€‹å‡½æ•¸
        }
        
        // æ–°å¢å‡½æ•¸è¼¸å…¥ (Mintermæ¨¡å¼)
        function addFunctionInput() {
            const functionInputs = document.getElementById('functionInputs');
            
            // è¨ˆç®—ç•¶å‰æ‡‰è©²çš„å‡½æ•¸ç·¨è™Ÿï¼ˆå¾1é–‹å§‹ï¼Œé€£çºŒç·¨è™Ÿï¼‰
            const currentFunctionCount = functionInputs.children.length;
            const functionDisplayId = currentFunctionCount + 1;
            const functionId = functionCounter++;
            
            const functionRow = document.createElement('div');
            functionRow.className = 'function-input-row';
            functionRow.id = `functionRow${functionId}`;
            functionRow.setAttribute('data-display-id', functionDisplayId);
            
            functionRow.innerHTML = `
                <div class="function-header">
                    <span class="function-label">å‡½æ•¸ F${functionDisplayId}</span>
                    <button class="btn btn-remove" onclick="removeFunctionInput(${functionId})">
                        âœ• ç§»é™¤å‡½æ•¸
                    </button>
                </div>
                <div class="function-inputs">
                    <div style="width: 100%;">
                        <span class="function-input-label">F${functionDisplayId} = Î£m(</span>
                        <input type="text" class="function-input" 
                               placeholder="" 
                               id="minterms${functionId}"
                               style="width: 150px; display: inline-block; margin: 0 5px;">
                        <span class="function-input-label">) + Î£d(</span>
                        <input type="text" class="function-input" 
                               placeholder="" 
                               id="dontcare${functionId}"
                               style="width: 120px; display: inline-block; margin: 0 5px;">
                        <span class="function-input-label">)</span>
                    </div>
                </div>
            `;
            
            functionInputs.appendChild(functionRow);
        }
        
        // ç§»é™¤å‡½æ•¸è¼¸å…¥ (Mintermæ¨¡å¼)
        function removeFunctionInput(functionId) {
            const functionInputs = document.getElementById('functionInputs');
            if (functionInputs.children.length <= 1) {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹å‡½æ•¸ï¼');
                return;
            }
            
            const functionRow = document.getElementById(`functionRow${functionId}`);
            if (functionRow) {
                functionRow.remove();
                // é‡æ–°æ•´ç†æ‰€æœ‰å‡½æ•¸çš„ç·¨è™Ÿ
                updateMintermFunctionNumbers();
            }
        }
        
        // é‡æ–°æ•´ç† Minterm æ¨¡å¼ä¸‹æ‰€æœ‰å‡½æ•¸çš„ç·¨è™Ÿ
        function updateMintermFunctionNumbers() {
            const functionInputs = document.getElementById('functionInputs');
            const functionRows = functionInputs.querySelectorAll('.function-input-row');
            
            functionRows.forEach((row, index) => {
                const displayId = index + 1;
                row.setAttribute('data-display-id', displayId);
                
                // æ›´æ–°å‡½æ•¸æ¨™é¡Œ
                const functionLabel = row.querySelector('.function-label');
                if (functionLabel) {
                    functionLabel.textContent = `å‡½æ•¸ F${displayId}`;
                }
                
                // æ›´æ–°å‡½æ•¸è¡¨é”å¼ä¸­çš„ç·¨è™Ÿ
                const functionLabels = row.querySelectorAll('.function-input-label');
                functionLabels.forEach(label => {
                    if (label.textContent.includes('F') && label.textContent.includes('=')) {
                        label.textContent = `F${displayId} = Î£m(`;
                    }
                });
            });
        }
        
        // æ¸…é™¤æ‰€æœ‰è¼¸å…¥
        function clearInputs() {
            document.getElementById('variables').value = '';
            
            const currentMode = document.querySelector('input[name="inputMode"]:checked').value;
            if (currentMode === 'pi') {
                initializeMultiplePIInputs();
            } else {
                initializeFunctionInputs();
            }
        }
        
        // åŸ·è¡Œå¤šè¼¸å‡ºæœ€ä½³åŒ–
        function runMultiOutputOptimization() {
            const loadingArea = document.getElementById('loadingArea');
            const resultArea = document.getElementById('resultArea');
            
            // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
            loadingArea.classList.add('show');
            resultArea.innerHTML = '';
            
            // æ”¶é›†è¼¸å…¥è³‡æ–™
            const variables = document.getElementById('variables').value.trim();
            const inputMode = document.querySelector('input[name="inputMode"]:checked').value;
            
            if (!variables) {
                setTimeout(() => {
                    loadingArea.classList.remove('show');
                    resultArea.innerHTML = `
                        <div style="color: #dc3545; text-align: center; margin-top: 50px;">
                            <h3>âŒ è¼¸å…¥éŒ¯èª¤</h3>
                            <p>è«‹å…ˆè¨­å®šè®Šæ•¸ï¼</p>
                        </div>
                    `;
                }, 1000);
                return;
            }
            
            let inputData = {};
            let hasValidInput = false;

            if (inputMode === 'pi') {
                // æ”¶é›† PI è³‡æ–™
                inputData = collectPIData();
                hasValidInput = Object.keys(inputData).length > 0;
                
                // åŒæ™‚æ”¶é›†è¼¸å‡ºå‡½æ•¸å®šç¾©ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                const outputFunctionsValue = document.getElementById('outputFunctions').value.trim();
                if (outputFunctionsValue) {
                    inputData.outputFunctions = parseOutputFunctions(outputFunctionsValue);
                }
            } else {
                // æ”¶é›† Minterm è³‡æ–™
                inputData = collectMintermData();
                hasValidInput = Object.keys(inputData).length > 0;
            }
            
            if (!hasValidInput) {
                setTimeout(() => {
                    loadingArea.classList.remove('show');
                    resultArea.innerHTML = `
                        <div style="color: #dc3545; text-align: center; margin-top: 50px;">
                            <h3>âŒ è¼¸å…¥éŒ¯èª¤</h3>
                            <p>è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹å‡½æ•¸çš„è³‡æ–™ï¼</p>
                        </div>
                    `;
                }, 1000);
                return;
            }
            
            // åŸ·è¡ŒçœŸæ­£çš„Patrick Methodç®—æ³•
            setTimeout(() => {
                try {
                    executePatrickMethod(variables, inputData, inputMode);
                } catch (error) {
                    console.error('åŸ·è¡ŒéŒ¯èª¤:', error);
                    loadingArea.classList.remove('show');
                    resultArea.innerHTML = `
                        <div style="color: #dc3545; text-align: center; margin-top: 50px;">
                            <h3>âŒ è¨ˆç®—éŒ¯èª¤</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }, 1000);
        }
        
        /**
         * åŸ·è¡Œ Patrick Method æ¼”ç®—æ³•ä¸»å‡½æ•¸
         * è™•ç†è¼¸å…¥è³‡æ–™ä¸¦èª¿ç”¨æ ¸å¿ƒæ¼”ç®—æ³•é€²è¡Œæœ€ä½³åŒ–
         * @param {string} variables - è®Šæ•¸å­—ä¸²
         * @param {Object} inputData - è¼¸å…¥è³‡æ–™ç‰©ä»¶
         * @param {string} inputMode - è¼¸å…¥æ¨¡å¼ï¼ˆ'pi' æˆ– 'minterm'ï¼‰
         */
        function executePatrickMethod(variables, inputData, inputMode) {
            const loadingArea = document.getElementById('loadingArea');
            const resultArea = document.getElementById('resultArea');
            
            try {
                console.log('ğŸš€ é–‹å§‹åŸ·è¡Œ Patrick Method');
                console.log('è®Šæ•¸:', variables);
                console.log('è¼¸å…¥è³‡æ–™:', inputData);
                console.log('è¼¸å…¥æ¨¡å¼:', inputMode);
                
                // è§£æè®Šæ•¸å­—ä¸²ç‚ºé™£åˆ—
                const variableList = variables.split(',').map(v => v.trim());
                const numVars = variableList.length;
                
                let mintermsByFunction = {};
                
                if (inputMode === 'pi') {
                    // PI æ¨¡å¼ï¼šéœ€è¦ä½¿ç”¨è¼¸å‡ºå‡½æ•¸å®šç¾©
                    if (inputData.outputFunctions && Object.keys(inputData.outputFunctions).length > 0) {
                        // ä½¿ç”¨è¼¸å‡ºå‡½æ•¸å®šç¾©ä¸­çš„ minterms
                        Object.entries(inputData.outputFunctions).forEach(([funcName, funcData]) => {
                            mintermsByFunction[funcName] = funcData.minterms || [];
                        });
                    } else {
                        // å¦‚æœæ²’æœ‰è¼¸å‡ºå‡½æ•¸å®šç¾©ï¼Œå¾ PI è¨ˆç®— minterms
                        Object.entries(inputData).forEach(([funcName, pis]) => {
                            if (funcName !== 'outputFunctions' && Array.isArray(pis)) {
                                const minterms = new Set();
                                pis.forEach(pi => {
                                    const piValue = pi.trim();
                                    if (piValue) {
                                        const coveredMinterms = calculateMintermsFromPI(piValue, numVars);
                                        coveredMinterms.forEach(m => minterms.add(m));
                                    }
                                });
                                mintermsByFunction[funcName] = Array.from(minterms).sort((a, b) => a - b);
                            }
                        });
                    }
                } else {
                    // Mintermæ¨¡å¼ï¼šæ”¶é›†mintermså’Œdon't careé …
                    const allDontCares = new Set();
                    
                    Object.entries(inputData).forEach(([funcName, funcData]) => {
                        mintermsByFunction[funcName] = funcData.minterms || [];
                        
                        // æ”¶é›†don't careé …
                        if (funcData.dontcare && funcData.dontcare.length > 0) {
                            const dontcares = funcData.dontcare.map(m => 
                                typeof m === 'string' ? parseInt(m.trim()) : m
                            ).filter(m => !isNaN(m));
                            dontcares.forEach(dc => allDontCares.add(dc));
                        }
                    });
                    
                    // å°‡æ‰€æœ‰don't careé …å‚³éçµ¦ç®—æ³•
                    var dontCares = Array.from(allDontCares);
                }
                
                console.log('è™•ç†å¾Œçš„minterms:', mintermsByFunction);
                
                // æª¢æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„å‡½æ•¸è³‡æ–™
                const validFunctions = Object.keys(mintermsByFunction).filter(
                    funcName => mintermsByFunction[funcName].length > 0
                );
                
                if (validFunctions.length === 0) {
                    throw new Error('æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„å‡½æ•¸è³‡æ–™ï¼è«‹æª¢æŸ¥è¼¸å…¥ã€‚');
                }
                
                // å‰µå»ºMultipleOutputPatrickå¯¦ä¾‹
                const multiPatrick = new MultipleOutputPatrick();
                
                // è¨­å®šè®Šæ•¸
                multiPatrick.variables = variableList;
                
                // åŸ·è¡Œå¤šè¼¸å‡ºæœ€ä½³åŒ–
                console.log('åŸ·è¡Œå¤šè¼¸å‡ºæœ€ä½³åŒ–...');
                const results = multiPatrick.executeMultipleOutput(mintermsByFunction, numVars, dontCares || []);
                
                console.log('æœ€ä½³åŒ–çµæœ:', results);
                
                // é¡¯ç¤ºçµæœ
                loadingArea.classList.remove('show');
                displayPatrickMethodResults(results, variableList);
                
            } catch (error) {
                console.error('Patrick MethodåŸ·è¡ŒéŒ¯èª¤:', error);
                loadingArea.classList.remove('show');
                resultArea.innerHTML = `
                    <div style="color: #dc3545; text-align: center; margin-top: 50px;">
                        <h3>âŒ è¨ˆç®—éŒ¯èª¤</h3>
                        <p>${error.message}</p>
                        <details style="margin-top: 15px; text-align: left;">
                            <summary>éŒ¯èª¤è©³æƒ…</summary>
                            <pre style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 12px;">${error.stack}</pre>
                        </details>
                    </div>
                `;
            }
        }
        
        /**
         * è¨ˆç®—å–®å€‹ç³»çµ±è§£æ±ºæ–¹æ¡ˆçš„æˆæœ¬
         * åŒ…æ‹¬å€‹åˆ¥æˆæœ¬ã€å…±äº«æˆæœ¬å’Œç¯€çœæˆæœ¬çš„è¨ˆç®—
         * @param {Object} systemSolution - ç³»çµ±è§£æ±ºæ–¹æ¡ˆç‰©ä»¶
         * @returns {Object} åŒ…å«å„ç¨®æˆæœ¬è³‡è¨Šçš„ç‰©ä»¶
         */
        function calculateSolutionCosts(systemSolution) {
            // è¨ˆç®—å€‹åˆ¥æˆæœ¬ç¸½å’Œï¼ˆä¸è€ƒæ…®å…±äº«ï¼‰
            let totalIndividualCost = 0;
            Object.values(systemSolution).forEach(solution => {
                totalIndividualCost += solution.cost;
            });

            // çµ±è¨ˆ Prime Implicants ä½¿ç”¨æ¬¡æ•¸
            const piUsageCount = new Map();
            Object.values(systemSolution).forEach(solution => {
                solution.pis.forEach(pi => {
                    const count = piUsageCount.get(pi.pattern) || 0;
                    piUsageCount.set(pi.pattern, count + 1);
                });
            });

            // è¨ˆç®—é‡è¤‡ PI çš„æˆæœ¬ç¯€çœ
            let duplicatedPICost = 0;
            piUsageCount.forEach((count, pattern) => {
                if (count > 1) {
                    // å¾ä»»ä¸€ä½¿ç”¨æ­¤ PI çš„å‡½æ•¸ä¸­ç²å– PI æˆæœ¬
                    const piCost = Object.values(systemSolution)
                        .flatMap(sol => sol.pis)
                        .find(pi => pi.pattern === pattern)?.cost || 0;
                    duplicatedPICost += (count - 1) * piCost;
                    console.log(`PI ${pattern} ä½¿ç”¨ ${count} æ¬¡ï¼Œæˆæœ¬ ${piCost}ï¼Œç¯€çœæˆæœ¬: ${(count-1) * piCost}`);
                }
            });
            console.log(`ç¸½é‡è¤‡ PI æˆæœ¬: ${duplicatedPICost}`);

            const sharedCost = totalIndividualCost - duplicatedPICost;
            const savings = totalIndividualCost - sharedCost;

            return {
                totalIndividualCost,
                sharedCost,
                savings
            };
        }

        /**
         * é¡¯ç¤º Patrick Method æ¼”ç®—æ³•çµæœ
         * æ ¼å¼åŒ–ä¸¦å±•ç¤ºæœ€ä½³åŒ–çµæœï¼ŒåŒ…æ‹¬è§£æ±ºæ–¹æ¡ˆå’Œæˆæœ¬åˆ†æ
         * @param {Object} results - æ¼”ç®—æ³•åŸ·è¡Œçµæœ
         * @param {Array} variables - è®Šæ•¸é™£åˆ—
         */
        function displayPatrickMethodResults(results, variables) {
            const resultArea = document.getElementById('resultArea');
            resultArea.classList.add('has-content');
            
            if (!results.success) {
                resultArea.innerHTML = `<div style="color: #dc3545;">âŒ è¨ˆç®—å¤±æ•—<br>${results.error || 'æœªçŸ¥éŒ¯èª¤'}</div>`;
                return;
            }
            
            let resultText = '';
            
            // åˆ¤æ–·æ˜¯å–®å‡½æ•¸é‚„æ˜¯å¤šå‡½æ•¸æ¨¡å¼
            let isSingleFunction = false;
            if (results.solutions) {
                isSingleFunction = Object.keys(results.solutions).length === 1;
            } else if (results.systemSolutions && results.systemSolutions.length > 0) {
                isSingleFunction = Object.keys(results.systemSolutions[0]).length === 1;
            } else if (results.allFormattedSolutions && results.allFormattedSolutions.length > 0) {
                // æª¢æŸ¥ç¬¬ä¸€å€‹æ ¼å¼åŒ–è§£æ±ºæ–¹æ¡ˆçš„å‡½æ•¸æ•¸é‡
                const firstSolution = results.allFormattedSolutions[0];
                if (firstSolution.expressions) {
                    isSingleFunction = firstSolution.expressions.length === 1;
                }
            }
            
            // å„ªå…ˆä½¿ç”¨æ–°çš„çµ±ä¸€æ ¼å¼åŒ–é¡¯ç¤º
            console.log('ğŸ” æª¢æŸ¥æ ¼å¼åŒ–è§£æ±ºæ–¹æ¡ˆ:', results.allFormattedSolutions);
            if (results.allFormattedSolutions && results.allFormattedSolutions.length > 0) {
                console.log('âœ… ä½¿ç”¨æ–°çš„çµ±ä¸€æ ¼å¼åŒ–é¡¯ç¤º');
                resultText += `ğŸ“Š æœ€ä½³åŒ–çµæœ\n`;
                resultText += `ğŸ¯ å¤šè¼¸å‡ºæœ€ä½³åŒ–çµæœ\n`;
                resultText += `è®Šæ•¸: ${variables.join(', ')}\n\n`;
                
                if (results.allFormattedSolutions.length > 1) {
                    resultText += `ğŸ¯ æ‰¾åˆ° ${results.allFormattedSolutions.length} å€‹ç›¸åŒæˆæœ¬çš„æœ€ä½³è§£æ±ºæ–¹æ¡ˆ\n\n`;
                    
                    results.allFormattedSolutions.forEach((formattedSolution, index) => {
                        resultText += `ğŸ”¹ è§£æ±ºæ–¹æ¡ˆ ${index + 1}:\n`;
                        if (formattedSolution.expressions) {
                            formattedSolution.expressions.forEach(expression => {
                                resultText += `${expression}\n`;
                            });
                        }
                        if (formattedSolution.usedPIPatterns) {
                            resultText += `ä½¿ç”¨çš„PI: ${formattedSolution.usedPIPatterns.join(', ')}\n`;
                        }
                        if (formattedSolution.sharedCost !== undefined) {
                            resultText += `å…±äº«æˆæœ¬: ${formattedSolution.sharedCost} å€‹é–˜ç´š\n`;
                        }
                        resultText += '\n';
                    });
                } else {
                    // å–®ä¸€è§£æ±ºæ–¹æ¡ˆ
                    const formattedSolution = results.allFormattedSolutions[0];
                    resultText += `ğŸ”¹ è§£æ±ºæ–¹æ¡ˆ:\n`;
                    if (formattedSolution.expressions) {
                        formattedSolution.expressions.forEach(expression => {
                            resultText += `${expression}\n`;
                        });
                    }
                    if (formattedSolution.usedPIPatterns) {
                        resultText += `ä½¿ç”¨çš„PI: ${formattedSolution.usedPIPatterns.join(', ')}\n`;
                    }
                    if (formattedSolution.sharedCost !== undefined) {
                        resultText += `å…±äº«æˆæœ¬: ${formattedSolution.sharedCost} å€‹é–˜ç´š\n`;
                    }
                    resultText += '\n';
                }
                
                // æˆæœ¬åˆ†æ
                if (results.totalIndividualCost && results.sharedOptimizedCost) {
                    resultText += `ğŸ’° æˆæœ¬åˆ†æ\n`;
                    if (isSingleFunction) {
                        resultText += `æˆæœ¬è¨ˆç®—æ–¹å¼ï¼š1å€‹literalæˆæœ¬=1ï¼Œå¤šå€‹literalsæˆæœ¬=literalæ•¸é‡+1\n`;
                        resultText += `ä¾‹å¦‚ï¼šy æœ‰ 1 å€‹ç¬¦è™Ÿï¼Œæˆæœ¬ç‚º 1ï¼›x'z' æœ‰ 2 å€‹ç¬¦è™Ÿï¼Œæˆæœ¬ç‚º 2 + 1 = 3\n\n`;
                    } else {
                        resultText += `æˆæœ¬è¨ˆç®—æ–¹å¼ï¼šæ¯å€‹é …çš„æˆæœ¬ = ç¬¦è™Ÿæ•¸é‡ + 1\n`;
                        resultText += `ä¾‹å¦‚ï¼šx'z' æœ‰ 2 å€‹ç¬¦è™Ÿï¼Œæˆæœ¬ç‚º 2 + 1 = 3\n\n`;
                    }
                    resultText += `å€‹åˆ¥æœ€ä½³åŒ–ç¸½æˆæœ¬: ${results.totalIndividualCost}\n`;
                    resultText += `å…±äº«æœ€ä½³åŒ–ç¸½æˆæœ¬: ${results.sharedOptimizedCost}\n`;
                    
                    if (results.savings > 0) {
                        resultText += `ğŸ’¡ ç¯€çœæˆæœ¬: ${results.savings} (${((results.savings / results.totalIndividualCost) * 100).toFixed(1)}%)\n`;
                    }
                    resultText += '\n';
                }
                
                // è¨ˆç®—æ­¥é©Ÿè©³è§£
                if (results.calculationSteps && results.calculationSteps.length > 0) {
                    resultText += `ğŸ” è¨ˆç®—æ­¥é©Ÿè©³è§£\n\n`;
                    results.calculationSteps.forEach(step => {
                        resultText += `æ­¥é©Ÿ ${step.step}: ${step.title}\n`;
                        resultText += `${step.description}\n`;
                        resultText += `${step.details.join('\n')}\n\n`;
                    });
                }
                
            } else {
                // å›é€€åˆ°å‚³çµ±é¡¯ç¤ºæ–¹å¼
                console.log('âš ï¸ æœªæ‰¾åˆ°æ ¼å¼åŒ–è§£æ±ºæ–¹æ¡ˆï¼Œä½¿ç”¨å‚³çµ±é¡¯ç¤ºæ–¹å¼');
                console.log('results.allFormattedSolutions:', results.allFormattedSolutions);
                console.log('results.formattedSolution:', results.formattedSolution);
                
                // ä¸»è¦çµæœæ¨™é¡Œ
                resultText += `ğŸ¯ å¤šè¼¸å‡ºæœ€ä½³åŒ–çµæœ\n`;
                resultText += `è®Šæ•¸: ${variables.join(', ')}\n\n`;
                
                // ç³»çµ±è§£é¡¯ç¤º
                if (results.systemSolutions && results.systemSolutions.length > 1) {
                resultText += `ğŸ¯ æ‰¾åˆ° ${results.systemSolutions.length} å€‹ç›¸åŒæˆæœ¬çš„æœ€ä½³è§£æ±ºæ–¹æ¡ˆ\n\n`;
                
                results.systemSolutions.forEach((systemSolution, index) => {
                    resultText += `ğŸ”¹ è§£æ±ºæ–¹æ¡ˆ ${index + 1}:\n`;
                    
                    // æŒ‰ç…§F1, F2, F3...çš„é †åºæ’åº
                    const sortedEntries = Object.entries(systemSolution).sort(([a], [b]) => {
                        const numA = parseInt(a.replace('F', ''));
                        const numB = parseInt(b.replace('F', ''));
                        return numA - numB;
                    });
                    
                    // é¡¯ç¤ºå‡½æ•¸è¡¨é”å¼
                    sortedEntries.forEach(([funcName, solution]) => {
                        resultText += `  ${funcName} = ${solution.expression}\n`;
                    });
                    
                    // æ”¶é›†ä½¿ç”¨çš„PIä¸¦è¨ˆç®—æˆæœ¬
                    const usedPIs = [];
                    sortedEntries.forEach(([funcName, solution]) => {
                        solution.pis.forEach(pi => {
                            if (!usedPIs.find(p => p.pattern === pi.pattern)) {
                                usedPIs.push(pi);
                            }
                        });
                    });
                    
                    resultText += `  ä½¿ç”¨çš„PI: ${usedPIs.map(pi => pi.pattern).join(', ')}\n`;
                    resultText += `  æˆæœ¬: ${usedPIs.reduce((sum, pi) => sum + pi.cost, 0)} å€‹é–˜ç´š\n\n`;
                });
                
                // æ·»åŠ æˆæœ¬çµ±è¨ˆ
                resultText += `ğŸ’° å¤šé‡è§£æˆæœ¬åˆ†æ\n`;
                const firstSolution = results.systemSolutions[0];
                const solutionCosts = calculateSolutionCosts(firstSolution);
                
                resultText += `æ‰€æœ‰è§£æ±ºæ–¹æ¡ˆæˆæœ¬ç›¸åŒ: ${solutionCosts.sharedCost}\n`;
                if (solutionCosts.savings > 0) {
                    resultText += `ç›¸æ¯”å€‹åˆ¥æœ€ä½³åŒ–ç¯€çœ: ${solutionCosts.savings} (${((solutionCosts.savings / solutionCosts.totalIndividualCost) * 100).toFixed(1)}%)\n`;
                }
                resultText += '\n';
                
            } else if (results.systemSolutions && results.systemSolutions.length === 1) {
                // å–®ä¸€ç³»çµ±è§£
                resultText += `ğŸ¯ å”¯ä¸€æœ€ä½³è§£æ±ºæ–¹æ¡ˆ\n\n`;
                
                const systemSolution = results.systemSolutions[0];
                const sortedEntries = Object.entries(systemSolution).sort(([a], [b]) => {
                    const numA = parseInt(a.replace('F', ''));
                    const numB = parseInt(b.replace('F', ''));
                    return numA - numB;
                });
                
                sortedEntries.forEach(([funcName, solution]) => {
                    resultText += `${funcName} = ${solution.expression}\n`;
                });
                
                const usedPIs = [];
                sortedEntries.forEach(([funcName, solution]) => {
                    solution.pis.forEach(pi => {
                        if (!usedPIs.find(p => p.pattern === pi.pattern)) {
                            usedPIs.push(pi);
                        }
                    });
                });
                
                resultText += `ä½¿ç”¨çš„PI: ${usedPIs.map(pi => pi.pattern).join(', ')}\n`;
                resultText += `æˆæœ¬: ${usedPIs.reduce((sum, pi) => sum + pi.cost, 0)} å€‹é–˜ç´š\n\n`;
                
            } else if (results.allSolutions && results.allSolutions.length > 1) {
                // æª¢æŸ¥æ˜¯å–®å‡½æ•¸é‚„æ˜¯å¤šå‡½æ•¸çš„å¤šè§£
                const firstSolution = results.allSolutions[0];
                const isMultiFunction = firstSolution && firstSolution.functions && Object.keys(firstSolution.functions).length > 1;
                
                if (isMultiFunction) {
                    // å¤šå‡½æ•¸å¤šè§£é¡¯ç¤º
                    resultText += `ğŸ¯ æ‰¾åˆ° ${results.allSolutions.length} å€‹ç›¸åŒæˆæœ¬çš„æœ€ä½³è§£æ±ºæ–¹æ¡ˆ\n\n`;
                    
                    results.allSolutions.forEach((solution) => {
                        resultText += `ğŸ”¹ è§£æ±ºæ–¹æ¡ˆ ${solution.solutionNumber}:\n`;
                        
                        // å®‰å…¨æª¢æŸ¥ solution.functions
                        if (solution.functions && typeof solution.functions === 'object') {
                            // æŒ‰ç…§F1, F2, F3...çš„é †åºé¡¯ç¤ºå‡½æ•¸
                            const sortedFunctions = Object.entries(solution.functions).sort(([a], [b]) => {
                                const numA = parseInt(a.replace('F', ''));
                                const numB = parseInt(b.replace('F', ''));
                                return numA - numB;
                            });
                            
                            sortedFunctions.forEach(([funcName, funcData]) => {
                                resultText += `  ${funcName} = ${funcData.expression}\n`;
                            });
                        }
                        
                        if (solution.usedPIPatterns) {
                            resultText += `  ä½¿ç”¨çš„PI: ${solution.usedPIPatterns.join(', ')}\n`;
                        }
                        if (solution.sharedCost !== undefined) {
                            resultText += `  å…±äº«æˆæœ¬: ${solution.sharedCost} å€‹é–˜ç´š\n`;
                        }
                        resultText += `\n`;
                    });
                } else {
                    // å–®å‡½æ•¸å¤šè§£é¡¯ç¤º
                    resultText += `ğŸ¯ æ‰¾åˆ° ${results.allSolutions.length} å€‹ç›¸åŒæˆæœ¬çš„æœ€ä½³è§£æ±ºæ–¹æ¡ˆ\n\n`;
                    
                    results.allSolutions.forEach((solution, index) => {
                        resultText += `è§£æ±ºæ–¹æ¡ˆ ${index + 1}: ${results.functionName || 'F1'} = ${solution.expression}\n`;
                        if (solution.pis) {
                            resultText += `ä½¿ç”¨çš„PI: ${solution.pis.map(pi => pi.pattern).join(', ')} | æˆæœ¬: ${solution.cost} å€‹é–˜ç´š\n\n`;
                        }
                    });
                }
                
            } else if (Object.keys(results.solutions || {}).length === 1 && results.allSolutions && results.allSolutions.length > 1) {
                // å–®å‡½æ•¸å¤šè§£é¡¯ç¤º
                resultText += `ğŸ¯ æ‰¾åˆ° ${results.allSolutions.length} å€‹ç›¸åŒæˆæœ¬çš„æœ€ä½³è§£æ±ºæ–¹æ¡ˆ\n\n`;
                
                results.allSolutions.forEach((solution, index) => {
                    resultText += `è§£æ±ºæ–¹æ¡ˆ ${index + 1}: ${results.functionName} = ${solution.expression}\n`;
                    resultText += `ä½¿ç”¨çš„PI: ${solution.pis.map(pi => pi.pattern).join(', ')} | æˆæœ¬: ${solution.cost} å€‹é–˜ç´š\n\n`;
                });
                
            } else {
                // å‚³çµ±é¡¯ç¤ºæ–¹å¼
                resultText += `ğŸ“Š å„å‡½æ•¸æœ€ä½³åŒ–çµæœ\n`;
                if (results.solutions && typeof results.solutions === 'object') {
                    Object.entries(results.solutions).forEach(([funcName, solution]) => {
                        if (solution && typeof solution === 'object') {
                            resultText += `${funcName}: ${funcName} = ${solution.expression || 'ç„¡è¡¨é”å¼'}\n`;
                            if (solution.pis && Array.isArray(solution.pis)) {
                                resultText += `ä½¿ç”¨çš„PI: ${solution.pis.map(pi => pi.pattern || pi).join(', ')} | æˆæœ¬: ${solution.cost || 0}\n\n`;
                            } else {
                                resultText += `æˆæœ¬: ${solution.cost || 0}\n\n`;
                            }
                        }
                    });
                } else {
                    resultText += `ç„¡è§£æ±ºæ–¹æ¡ˆæ•¸æ“š\n\n`;
                }
            }
            
            // å…±äº«Prime Implicants
            if (results.sharedPIs && results.sharedPIs.length > 0) {
                resultText += `ğŸ”„ å…±äº«Prime Implicants\n`;
                results.sharedPIs.forEach(sharedPI => {
                    const algebraic = convertPatternToAlgebraicDisplay(sharedPI.pattern, variables);
                    resultText += `${sharedPI.pattern} â†’ ${algebraic} (ç”¨æ–¼: ${sharedPI.usedBy.join(', ')}, æˆæœ¬: ${sharedPI.cost})\n`;
                });
                resultText += '\n';
            }
            
            // æˆæœ¬åˆ†æ
            resultText += `ğŸ’° æˆæœ¬åˆ†æ\n`;
            if (isSingleFunction) {
                resultText += `æˆæœ¬è¨ˆç®—æ–¹å¼ï¼š1å€‹literalæˆæœ¬=1ï¼Œå¤šå€‹literalsæˆæœ¬=literalæ•¸é‡+1\n`;
                resultText += `ä¾‹å¦‚ï¼šy æœ‰ 1 å€‹ç¬¦è™Ÿï¼Œæˆæœ¬ç‚º 1ï¼›x'z' æœ‰ 2 å€‹ç¬¦è™Ÿï¼Œæˆæœ¬ç‚º 2 + 1 = 3\n\n`;
            } else {
                resultText += `æˆæœ¬è¨ˆç®—æ–¹å¼ï¼šæ¯å€‹é …çš„æˆæœ¬ = ç¬¦è™Ÿæ•¸é‡ + 1\n`;
                resultText += `ä¾‹å¦‚ï¼šx'z' æœ‰ 2 å€‹ç¬¦è™Ÿï¼Œæˆæœ¬ç‚º 2 + 1 = 3\n\n`;
            }
            resultText += `å€‹åˆ¥æœ€ä½³åŒ–ç¸½æˆæœ¬: ${results.totalIndividualCost}\n`;
            resultText += `å…±äº«æœ€ä½³åŒ–ç¸½æˆæœ¬: ${results.sharedOptimizedCost}\n`;
            
            if (results.savings > 0) {
                resultText += `ğŸ’¡ ç¯€çœæˆæœ¬: ${results.savings} (${((results.savings / results.totalIndividualCost) * 100).toFixed(1)}%)\n`;
            }
            resultText += '\n';
            
            // è¨ˆç®—æ­¥é©Ÿè©³è§£
            if (results.calculationSteps && results.calculationSteps.length > 0) {
                resultText += `ğŸ” è¨ˆç®—æ­¥é©Ÿè©³è§£\n\n`;
                results.calculationSteps.forEach(step => {
                    resultText += `æ­¥é©Ÿ ${step.step}: ${step.title}\n`;
                    resultText += `${step.description}\n`;
                    resultText += `${step.details.join('\n')}\n\n`;
                });
            }
            
            }
            
            // å°‡ç´”æ–‡å­—è½‰æ›ç‚ºHTMLï¼Œä¿ç•™æ›è¡Œ
            const resultHTML = resultText.replace(/\n/g, '<br>');
            resultArea.innerHTML = `<div style="font-family: 'Courier New', monospace; line-height: 1.5; white-space: pre-wrap;">${resultHTML}</div>`;
        }
        
        // è¼”åŠ©å‡½æ•¸ï¼šå°‡patternè½‰æ›ç‚ºä»£æ•¸è¡¨é”å¼é¡¯ç¤º
        function convertPatternToAlgebraicDisplay(pattern, variables) {
            let algebraic = '';
            
            for (let i = 0; i < pattern.length; i++) {
                if (pattern[i] === '1') {
                    algebraic += variables[i] || `X${i}`;
                } else if (pattern[i] === '0') {
                    algebraic += (variables[i] || `X${i}`) + "'";
                }
            }
            
            return algebraic || '1';
        }
        
        // æ”¶é›† PI è³‡æ–™
        function collectPIData() {
            const data = {};
            const multiplePIInputs = document.getElementById('multiplePIInputs');
            const functionGroups = multiplePIInputs.querySelectorAll('.function-pi-group');
            
            functionGroups.forEach((group, index) => {
                const displayId = group.getAttribute('data-display-id') || (index + 1);
                const functionId = group.id.replace('functionPIGroup', '');
                const functionPIInputs = document.getElementById(`functionPIInputs${functionId}`);
                const piInputs = functionPIInputs.querySelectorAll('.pi-input');
                const pis = Array.from(piInputs)
                    .map(input => input.value.trim())
                    .filter(value => value !== '');
                
                if (pis.length > 0) {
                    data[`F${displayId}`] = pis;
                }
            });
            
            return data;
        }
        
        // æ”¶é›† Minterm è³‡æ–™
        function collectMintermData() {
            const data = {};
            
            const functionInputs = document.getElementById('functionInputs');
            const functionRows = functionInputs.querySelectorAll('.function-input-row');
            
            functionRows.forEach((row, index) => {
                const displayId = row.getAttribute('data-display-id') || (index + 1);
                const functionId = row.id.replace('functionRow', '');
                const mintermsInput = document.getElementById(`minterms${functionId}`);
                const dontcareInput = document.getElementById(`dontcare${functionId}`);
                
                const minterms = mintermsInput ? mintermsInput.value.trim() : '';
                const dontcare = dontcareInput ? dontcareInput.value.trim() : '';
                
                if (minterms) {
                    data[`F${displayId}`] = {
                        minterms: minterms.split(',').map(m => m.trim()).filter(m => m),
                        dontcare: dontcare ? dontcare.split(',').map(m => m.trim()).filter(m => m) : []
                    };
                }
            });
            
            return data;
        }
        
        // è‡ªå‹•ç”Ÿæˆå‡½æ•¸å®šç¾© (PI æ¨¡å¼)
        function generateFunctionDefinitions() {
            const variables = document.getElementById('variables').value.trim();
            
            if (!variables) {
                alert('è«‹å…ˆè¨­å®šè®Šæ•¸ï¼');
                return;
            }
            
            const variableList = variables.split(',').map(v => v.trim());
            const numVars = variableList.length;
            
            if (numVars === 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„è®Šæ•¸ï¼');
                return;
            }
            
            // æ”¶é›† PI è³‡æ–™
            const piData = collectPIData();
            
            if (Object.keys(piData).length === 0) {
                alert('è«‹å…ˆè¼¸å…¥ Prime Implicantsï¼');
                return;
            }
            
            let functionDefinitions = [];
            
            // ç‚ºæ¯å€‹å‡½æ•¸è¨ˆç®— minterms
            Object.keys(piData).forEach(functionName => {
                const pis = piData[functionName];
                const minterms = new Set();
                
                pis.forEach(pi => {
                    const piValue = pi.trim();
                    if (piValue) {
                        // è¨ˆç®—é€™å€‹ PI è¦†è“‹çš„æ‰€æœ‰ minterms
                        const coveredMinterms = calculateMintermsFromPI(piValue, numVars);
                        coveredMinterms.forEach(m => minterms.add(m));
                    }
                });
                
                // è½‰æ›ç‚ºæ’åºå¾Œçš„é™£åˆ—
                const sortedMinterms = Array.from(minterms).sort((a, b) => a - b);
                
                if (sortedMinterms.length > 0) {
                    functionDefinitions.push(`${functionName}: ${sortedMinterms.join(',')}`);
                }
            });
            
            // å°‡ç”Ÿæˆçš„å‡½æ•¸å®šç¾©å¡«å…¥æ–‡æœ¬åŸŸ
            const outputFunctionsTextarea = document.getElementById('outputFunctions');
            if (outputFunctionsTextarea) {
                outputFunctionsTextarea.value = functionDefinitions.join('\n');
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                alert(`âœ… å·²è‡ªå‹•ç”Ÿæˆ ${functionDefinitions.length} å€‹å‡½æ•¸çš„å®šç¾©ï¼\n\nè«‹æª¢æŸ¥ä¸¦ç¢ºèªè¼¸å‡ºå‡½æ•¸å®šç¾©å€åŸŸçš„å…§å®¹ã€‚`);
                
                // è®“æ–‡æœ¬åŸŸç²å¾—ç„¦é»ä¸¦æ»¾å‹•åˆ°è©²ä½ç½®
                outputFunctionsTextarea.focus();
                outputFunctionsTextarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // è§£æè¼¸å‡ºå‡½æ•¸å®šç¾©
        function parseOutputFunctions(outputFunctionsText) {
            const outputFunctions = {};
            const lines = outputFunctionsText.split('\n').filter(line => line.trim());
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.includes(':')) {
                    const [functionPart, mintermsPart] = trimmedLine.split(':').map(part => part.trim());
                    
                    // æå–å‡½æ•¸åç¨±ï¼ˆç§»é™¤å¯èƒ½çš„ 'F' å‰ç¶´ï¼‰
                    let functionName = functionPart;
                    if (functionName.match(/^F\d+$/)) {
                        // ä¿æŒ F1, F2 æ ¼å¼
                    } else if (functionName.match(/^\d+$/)) {
                        // å¦‚æœåªæ˜¯æ•¸å­—ï¼ŒåŠ ä¸Š F å‰ç¶´
                        functionName = 'F' + functionName;
                    }
                    
                    // è§£æ mintermsï¼ˆæ”¯æ´å¤šç¨®æ ¼å¼ï¼‰
                    let minterms = [];
                    if (mintermsPart) {
                        // ç§»é™¤å¯èƒ½çš„ 'm' å‰ç¶´å’Œç©ºæ ¼
                        const cleanMinterms = mintermsPart.replace(/m/g, '').replace(/\s/g, '');
                        minterms = cleanMinterms.split(',')
                            .map(term => term.trim())
                            .filter(term => term && !isNaN(term))
                            .map(term => parseInt(term));
                    }
                    
                    if (minterms.length > 0) {
                        outputFunctions[functionName] = {
                            minterms: minterms.sort((a, b) => a - b),
                            dontcare: [] // é è¨­æ²’æœ‰ don't care
                        };
                    }
                }
            });
            
            return outputFunctions;
        }
        
        // å¾ PI è¨ˆç®—è¦†è“‹çš„ minterms
        function calculateMintermsFromPI(pi, numVars) {
            const minterms = [];
            
            // ç§»é™¤ç©ºæ ¼ä¸¦é©—è­‰é•·åº¦
            pi = pi.replace(/\s/g, '');
            if (pi.length !== numVars) {
                console.warn(`PI "${pi}" é•·åº¦ä¸ç¬¦åˆè®Šæ•¸æ•¸é‡ ${numVars}`);
                return minterms;
            }
            
            // è¨ˆç®—æ‰€æœ‰å¯èƒ½çš„çµ„åˆ
            const dontCarePositions = [];
            const fixedBits = [];
            
            for (let i = 0; i < pi.length; i++) {
                if (pi[i] === '-') {
                    dontCarePositions.push(i);
                    fixedBits.push(0); // æš«æ™‚è¨­ç‚º0
                } else if (pi[i] === '0' || pi[i] === '1') {
                    fixedBits.push(parseInt(pi[i]));
                } else {
                    console.warn(`PI "${pi}" åŒ…å«ç„¡æ•ˆå­—ç¬¦ "${pi[i]}"`);
                    return minterms;
                }
            }
            
            // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„çµ„åˆ
            const numCombinations = Math.pow(2, dontCarePositions.length);
            
            for (let combo = 0; combo < numCombinations; combo++) {
                const currentBits = [...fixedBits];
                
                // è¨­ç½® don't care ä½ç½®çš„å€¼
                for (let i = 0; i < dontCarePositions.length; i++) {
                    const pos = dontCarePositions[i];
                    const bit = (combo >> i) & 1;
                    currentBits[pos] = bit;
                }
                
                // è¨ˆç®— minterm å€¼
                let mintermValue = 0;
                for (let i = 0; i < currentBits.length; i++) {
                    mintermValue += currentBits[i] * Math.pow(2, numVars - 1 - i);
                }
                
                minterms.push(mintermValue);
            }
            
            return minterms.sort((a, b) => a - b);
        }
        
        // URL åƒæ•¸è™•ç†å’Œåˆ†äº«åŠŸèƒ½
        function initializeFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // è™•ç†æ¨¡å¼åˆ‡æ›
            const mode = urlParams.get('mode');
            if (mode === 'pi' || mode === 'minterm') {
                updateInputMode(mode);
            } else {
                updateInputMode('pi'); // é»˜èªç‚º PI æ¨¡å¼
            }
            
            // è™•ç†åˆ†äº«çš„å…§å®¹
            const sharedTitle = urlParams.get('title');
            const sharedText = urlParams.get('text');
            const sharedUrl = urlParams.get('url');
            
            if (sharedText) {
                // å˜—è©¦è§£æåˆ†äº«çš„æ–‡æœ¬ä½œç‚ºå‡½æ•¸å®šç¾©
                try {
                    const outputFunctionsTextarea = document.getElementById('outputFunctions');
                    if (outputFunctionsTextarea && sharedText.includes(':')) {
                        outputFunctionsTextarea.value = sharedText;
                        alert('å·²è¼‰å…¥åˆ†äº«çš„å‡½æ•¸å®šç¾©ï¼');
                    }
                } catch (error) {
                    console.log('ç„¡æ³•è§£æåˆ†äº«çš„å…§å®¹:', error);
                }
            }
        }
        
        // åˆ†äº«ç•¶å‰çµæœ
        function shareResults() {
            if (!navigator.share) {
                // é™ç´šåˆ°è¤‡è£½åˆ°å‰ªè²¼æ¿
                copyResultsToClipboard();
                return;
            }
            
            const resultArea = document.getElementById('resultArea');
            if (!resultArea || !resultArea.innerHTML.trim() || resultArea.innerHTML.includes('ç­‰å¾…è¼¸å…¥')) {
                alert('è«‹å…ˆåŸ·è¡Œ Patrick Method ä»¥ç²å¾—çµæœï¼');
                return;
            }
            
            // æ”¶é›†ç•¶å‰çš„å‡½æ•¸å®šç¾©
            let shareText = '';
            const outputFunctionsTextarea = document.getElementById('outputFunctions');
            if (outputFunctionsTextarea && outputFunctionsTextarea.value.trim()) {
                shareText = outputFunctionsTextarea.value.trim();
            }
            
            // å¦‚æœæ²’æœ‰å‡½æ•¸å®šç¾©ï¼Œå˜—è©¦å¾çµæœä¸­æå–
            if (!shareText) {
                const resultText = resultArea.textContent || resultArea.innerText;
                const lines = resultText.split('\n').filter(line => line.trim());
                shareText = lines.slice(0, 10).join('\n'); // å–å‰10è¡Œ
            }
            
            navigator.share({
                title: 'å¸ƒæ—å‡½æ•¸æœ€å°åŒ–çµæœ',
                text: shareText,
                url: window.location.href
            }).catch(error => {
                console.log('åˆ†äº«å¤±æ•—:', error);
                copyResultsToClipboard();
            });
        }
        
        // è¤‡è£½çµæœåˆ°å‰ªè²¼æ¿ï¼ˆé™ç´šæ–¹æ¡ˆï¼‰
        function copyResultsToClipboard() {
            const resultArea = document.getElementById('resultArea');
            if (!resultArea || !resultArea.innerHTML.trim() || resultArea.innerHTML.includes('ç­‰å¾…è¼¸å…¥')) {
                alert('è«‹å…ˆåŸ·è¡Œ Patrick Method ä»¥ç²å¾—çµæœï¼');
                return;
            }
            
            const resultText = resultArea.textContent || resultArea.innerText;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(resultText).then(() => {
                    alert('çµæœå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
                }).catch(error => {
                    console.log('è¤‡è£½å¤±æ•—:', error);
                    fallbackCopyToClipboard(resultText);
                });
            } else {
                fallbackCopyToClipboard(resultText);
            }
        }
        
        // é™ç´šè¤‡è£½æ–¹æ¡ˆ
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('çµæœå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            } catch (error) {
                console.log('è¤‡è£½å¤±æ•—:', error);
                alert('ç„¡æ³•è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼Œè«‹æ‰‹å‹•é¸æ“‡ä¸¦è¤‡è£½çµæœã€‚');
            }
            
            document.body.removeChild(textArea);
        }
        
        // è™•ç†æª”æ¡ˆæ‹–æ”¾å’Œé–‹å•Ÿ
        function setupFileHandling() {
            const dropZone = document.body;
            
            // é˜²æ­¢é è¨­çš„æ‹–æ”¾è¡Œç‚º
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            // è™•ç†æª”æ¡ˆæ‹–æ”¾
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    handleFiles(files);
                }
            }
            
            function handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (file.type === 'text/plain' || file.type === 'application/json' || file.name.endsWith('.txt')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const content = e.target.result;
                            loadContentFromFile(content);
                        };
                        reader.readAsText(file);
                    }
                });
            }
            
            function loadContentFromFile(content) {
                try {
                    // å˜—è©¦è¼‰å…¥ç‚ºå‡½æ•¸å®šç¾©
                    const outputFunctionsTextarea = document.getElementById('outputFunctions');
                    if (outputFunctionsTextarea) {
                        outputFunctionsTextarea.value = content;
                        alert('å·²è¼‰å…¥æª”æ¡ˆå…§å®¹ï¼');
                    }
                } catch (error) {
                    console.log('è¼‰å…¥æª”æ¡ˆå¤±æ•—:', error);
                    alert('ç„¡æ³•è¼‰å…¥æª”æ¡ˆå…§å®¹ã€‚');
                }
            }
        }
        
        // åˆå§‹åŒ–ç•Œé¢
        initializeFromURL();
        setupFileHandling();
    </script>
</body>
</html> 